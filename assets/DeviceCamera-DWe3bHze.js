import{m as l,f as i,R as d,C as v,j as u}from"./index-D8ybx4Tv.js";import{C as p}from"./camera-BQeuiYoI.js";var f=Object.defineProperty,C=Object.getOwnPropertyDescriptor,o=(c,e,a,r)=>{for(var t=r>1?void 0:r?C(e,a):e,n=c.length-1,m;n>=0;n--)(m=c[n])&&(t=(r?m(e,a,t):m(t))||t);return r&&t&&f(e,a,t),t};let s=class extends l(p){cameraVideo;async startPlayback(){this.updateStatus("connecting");try{const e=await this.getUserMedia();this.cameraVideo.srcObject=e,this.updateCameraName(await this.getDeviceLabel()??"")}catch(e){i.error(`[DeviceCamera] failed to start playback "${this.getSelectedDeviceCamera()}"`,e),this.updateStatus("error")}}stopPlayback(){this.updateStatus("disconnected");try{const e=this.cameraVideo.srcObject;if(e)for(const a of e.getTracks())a.stop(),e.removeTrack(a)}catch(e){i.error("[DeviceCamera] failed to stop and remove all tracks",e)}this.cameraVideo.srcObject=null}async getUserMedia(){const e=this.getSelectedDeviceCamera();try{const a=["environment","user"].includes(e)?"facingMode":"deviceId";return await navigator.mediaDevices.getUserMedia({video:{[a]:e}})}catch(a){return i.error(`[DeviceCamera] failed to select device "${e}"`,a),this.setSelectedDeviceCamera(null),await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}})}}async enumerateDevices(){try{return(await navigator.mediaDevices.enumerateDevices()).filter(a=>a.kind==="videoinput")}catch(e){return i.error("[DeviceCamera] failed to enumerate devices",e),[]}}async getDeviceLabel(){if(this.cameraNameMenuItems.length===0){const a=await this.enumerateDevices(),r=[{icon:"$camera",text:this.$tc("app.general.label.environment_facing"),value:"environment"},{icon:"$camera",text:this.$tc("app.general.label.user_facing"),value:"user"},...a.map(t=>({icon:"$camera",text:t.label,value:t.deviceId}))];this.updateCameraNameMenuItems(r)}const e=this.getSelectedDeviceCamera();return this.cameraNameMenuItems.find(a=>a.value===e)?.text}getSelectedDeviceCamera(){return localStorage.getItem("deviceCamera.selectedCamera")??"environment"}setSelectedDeviceCamera(e){e?localStorage.setItem("deviceCamera.selectedCamera",e):localStorage.removeItem("deviceCamera.selectedCamera")}menuItemClick(e){this.getSelectedDeviceCamera()!==e.value&&(this.setSelectedDeviceCamera(e.value),this.stopPlayback(),this.updateCameraName(e.text),this.startPlayback())}};o([d("streamingElement")],s.prototype,"cameraVideo",2);s=o([v({})],s);var h=function(){var e=this,a=e._self._c;return e._self._setupProxy,a("video",{ref:"streamingElement",style:e.cameraStyle,attrs:{autoplay:"",disablePictureInPicture:"",playsinline:"",muted:""},domProps:{muted:!0},on:{play:function(r){return e.updateStatus("connected")},error:function(r){return e.updateStatus("error")}}})},g=[],D=u(s,h,g,!1,null,null);const b=D.exports;export{b as default};
