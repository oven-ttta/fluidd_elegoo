(function(){"use strict";const F=new Uint8Array([13,10,13,10]),u=(o,t,e)=>{for(;;){const s=o.indexOf(t[0],e);if(s===-1||s+t.length>o.length)return-1;if(t.every((r,n)=>o[s+n]===r))return s;e=s+1}},C=async(o,t)=>{const e=await fetch(o,{mode:"cors"});if(!e.ok)throw new Error(`Failed to fetch MJPEG stream: ${e.status}`);const s=e.headers.get("content-type")||"";if(!s.includes("multipart"))throw new Error(`Invalid content-type "${s}"`);const r=s.match(/boundary=([^;]+)/)?.[1];if(!r)throw new Error(`Boundary not found in content-type "${s}"`);const n=new TextEncoder().encode(`--${r}`),a=e.body.getReader({mode:"byob"});let i=new Uint8Array(0);try{for(;;){const p=new Uint8Array(8192),{done:f,value:b}=await a.read(p);if(f)break;const m=new Uint8Array(i.length+b.length);for(m.set(i),m.set(b,i.length),i=m;;){const S=u(i,n);if(S===-1)break;const k=S+n.length,h=u(i,n,k);if(h===-1)break;const w=u(i,F,k);if(w!==-1&&w<h){const R=i.slice(w+4,h);t(R)}i=i.slice(h)}}}finally{a.releaseLock()}},c={fatal:0,error:0,warn:1,log:2,info:3,success:3,fail:3,debug:4,trace:5,verbose:Number.POSITIVE_INFINITY},v={silent:{level:-1},fatal:{level:c.fatal},error:{level:c.error},warn:{level:c.warn},log:{level:c.log},info:{level:c.info},success:{level:c.success},fail:{level:c.fail},ready:{level:c.info},start:{level:c.info},box:{level:c.info},debug:{level:c.debug},trace:{level:c.trace},verbose:{level:c.verbose}};function g(o){if(o===null||typeof o!="object")return!1;const t=Object.getPrototypeOf(o);return t!==null&&t!==Object.prototype&&Object.getPrototypeOf(t)!==null||Symbol.iterator in o?!1:Symbol.toStringTag in o?Object.prototype.toString.call(o)==="[object Module]":!0}function d(o,t,e=".",s){if(!g(t))return d(o,{},e);const r=Object.assign({},t);for(const n in o){if(n==="__proto__"||n==="constructor")continue;const a=o[n];a!=null&&(Array.isArray(a)&&Array.isArray(r[n])?r[n]=[...a,...r[n]]:g(a)&&g(r[n])?r[n]=d(a,r[n],(e?`${e}.`:"")+n.toString()):r[n]=a)}return r}function T(o){return(...t)=>t.reduce((e,s)=>d(e,s,""),{})}const M=T();function A(o){return Object.prototype.toString.call(o)==="[object Object]"}function j(o){return!(!A(o)||!o.message&&!o.args||o.stack)}let y=!1;const L=[];class l{options;_lastLog;_mockFn;constructor(t={}){const e=t.types||v;this.options=M({...t,defaults:{...t.defaults},level:_(t.level,e),reporters:[...t.reporters||[]]},{types:v,throttle:1e3,throttleMin:5,formatOptions:{date:!0,colors:!1,compact:!0}});for(const s in e){const r={type:s,...this.options.defaults,...e[s]};this[s]=this._wrapLogFn(r),this[s].raw=this._wrapLogFn(r,!0)}this.options.mockFn&&this.mockTypes(),this._lastLog={}}get level(){return this.options.level}set level(t){this.options.level=_(t,this.options.types,this.options.level)}prompt(t,e){if(!this.options.prompt)throw new Error("prompt is not supported!");return this.options.prompt(t,e)}create(t){const e=new l({...this.options,...t});return this._mockFn&&e.mockTypes(this._mockFn),e}withDefaults(t){return this.create({...this.options,defaults:{...this.options.defaults,...t}})}withTag(t){return this.withDefaults({tag:this.options.defaults.tag?this.options.defaults.tag+":"+t:t})}addReporter(t){return this.options.reporters.push(t),this}removeReporter(t){if(t){const e=this.options.reporters.indexOf(t);if(e!==-1)return this.options.reporters.splice(e,1)}else this.options.reporters.splice(0);return this}setReporters(t){return this.options.reporters=Array.isArray(t)?t:[t],this}wrapAll(){this.wrapConsole(),this.wrapStd()}restoreAll(){this.restoreConsole(),this.restoreStd()}wrapConsole(){for(const t in this.options.types)console["__"+t]||(console["__"+t]=console[t]),console[t]=this[t].raw}restoreConsole(){for(const t in this.options.types)console["__"+t]&&(console[t]=console["__"+t],delete console["__"+t])}wrapStd(){this._wrapStream(this.options.stdout,"log"),this._wrapStream(this.options.stderr,"log")}_wrapStream(t,e){t&&(t.__write||(t.__write=t.write),t.write=s=>{this[e].raw(String(s).trim())})}restoreStd(){this._restoreStream(this.options.stdout),this._restoreStream(this.options.stderr)}_restoreStream(t){t&&t.__write&&(t.write=t.__write,delete t.__write)}pauseLogs(){y=!0}resumeLogs(){y=!1;const t=L.splice(0);for(const e of t)e[0]._logFn(e[1],e[2])}mockTypes(t){const e=t||this.options.mockFn;if(this._mockFn=e,typeof e=="function")for(const s in this.options.types)this[s]=e(s,this.options.types[s])||this[s],this[s].raw=this[s]}_wrapLogFn(t,e){return(...s)=>{if(y){L.push([this,t,s,e]);return}return this._logFn(t,s,e)}}_logFn(t,e,s){if((t.level||0)>this.level)return!1;const r={date:new Date,args:[],...t,level:_(t.level,this.options.types)};!s&&e.length===1&&j(e[0])?Object.assign(r,e[0]):r.args=[...e],r.message&&(r.args.unshift(r.message),delete r.message),r.additional&&(Array.isArray(r.additional)||(r.additional=r.additional.split(`
`)),r.args.push(`
`+r.additional.join(`
`)),delete r.additional),r.type=typeof r.type=="string"?r.type.toLowerCase():"log",r.tag=typeof r.tag=="string"?r.tag:"";const n=(i=!1)=>{const p=(this._lastLog.count||0)-this.options.throttleMin;if(this._lastLog.object&&p>0){const f=[...this._lastLog.object.args];p>1&&f.push(`(repeated ${p} times)`),this._log({...this._lastLog.object,args:f}),this._lastLog.count=1}i&&(this._lastLog.object=r,this._log(r))};clearTimeout(this._lastLog.timeout);const a=this._lastLog.time&&r.date?r.date.getTime()-this._lastLog.time.getTime():0;if(this._lastLog.time=r.date,a<this.options.throttle)try{const i=JSON.stringify([r.type,r.tag,r.args]),p=this._lastLog.serialized===i;if(this._lastLog.serialized=i,p&&(this._lastLog.count=(this._lastLog.count||0)+1,this._lastLog.count>this.options.throttleMin)){this._lastLog.timeout=setTimeout(n,this.options.throttle);return}}catch{}n(!0)}_log(t){for(const e of this.options.reporters)e.log(t,{options:this.options})}}function _(o,t={},e=3){return o===void 0?e:typeof o=="number"?o:t[o]&&t[o].level!==void 0?t[o].level:e}l.prototype.add=l.prototype.addReporter,l.prototype.remove=l.prototype.removeReporter,l.prototype.clear=l.prototype.removeReporter,l.prototype.withScope=l.prototype.withTag,l.prototype.mock=l.prototype.mockTypes,l.prototype.pause=l.prototype.pauseLogs,l.prototype.resume=l.prototype.resumeLogs;function $(o={}){return new l(o)}class E{options;defaultColor;levelColorMap;typeColorMap;constructor(t){this.options={...t},this.defaultColor="#7f8c8d",this.levelColorMap={0:"#c0392b",1:"#f39c12",3:"#00BCD4"},this.typeColorMap={success:"#2ecc71"}}_getLogFn(t){return t<1?console.__error||console.error:t===1?console.__warn||console.warn:console.__log||console.log}log(t){const e=this._getLogFn(t.level),s=t.type==="log"?"":t.type,r=t.tag||"",a=`
      background: ${this.typeColorMap[t.type]||this.levelColorMap[t.level]||this.defaultColor};
      border-radius: 0.5em;
      color: white;
      font-weight: bold;
      padding: 2px 0.5em;
    `,i=`%c${[r,s].filter(Boolean).join(":")}`;typeof t.args[0]=="string"?e(`${i}%c ${t.args[0]}`,a,"",...t.args.slice(1)):e(i,a,...t.args)}}function O(o={}){return $({reporters:o.reporters||[new E({})],prompt(e,s={}){return s.type==="confirm"?Promise.resolve(confirm(e)):Promise.resolve(prompt(e))},...o})}const P=O(),B=o=>{const t={action:"frame",data:o};self.postMessage(t,[o.buffer])},x=()=>{const o={action:"done"};self.postMessage(o)},D=o=>{const t={action:"error",error:o};self.postMessage(t)};self.onmessage=async o=>{const t=o.data;try{t.action==="start"&&(await C(t.url,B),x())}catch(e){P.error("[MjpegStream] error in worker",e),D(e)}}})();
