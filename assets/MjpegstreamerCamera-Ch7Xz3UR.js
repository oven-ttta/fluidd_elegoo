import{m as h,f as p,R as u,C as g,j as d}from"./index-Dnfjscuv.js";import{C as b}from"./camera-BkgcWKh1.js";function f(a){return new Worker(""+new URL("mjpegStream.worker-MY5npAJ_.js",import.meta.url).href,{name:a?.name})}var j=Object.defineProperty,_=Object.getOwnPropertyDescriptor,m=(a,e,r,s)=>{for(var t=s>1?void 0:s?_(e,r):e,o=a.length-1,i;o>=0;o--)(i=a[o])&&(t=(s?i(e,r,t):i(t))||t);return s&&t&&j(e,r,t),t};let n=class extends h(b){cameraImage;startTime=0;time=0;timeSmoothing=.6;worker=null;imageObjectUrl=null;handleImageLoad(){this.updateStatus("connected"),this.revokeImageObjectURL()}handleImageError(){this.updateStatus("error"),this.revokeImageObjectURL()}revokeImageObjectURL(){const e=this.imageObjectUrl;e!=null&&(URL.revokeObjectURL(e),this.imageObjectUrl=null)}startPlayback(){try{this.updateStatus("connecting");const e=this.buildAbsoluteUrl(this.camera.stream_url||"");e.searchParams.set("cacheBust",Date.now().toString());const r=this.worker=new f;r.addEventListener("message",t=>{const o=t.data;switch(o.action){case"frame":{const i=performance.now(),c=i-this.startTime;this.time=this.time*this.timeSmoothing+c*(1-this.timeSmoothing),this.startTime=i,this.time!==0&&this.updateFramesPerSecond(Math.round(1e3/this.time)),this.revokeImageObjectURL();const l=new Blob([o.data.buffer],{type:"image/jpeg"});this.cameraImage.src=this.imageObjectUrl=URL.createObjectURL(l);break}case"done":this.stopPlayback();break;case"error":this.updateStatus("error"),this.stopPlayback();break}});const s={action:"start",url:e.toString()};this.time=0,this.startTime=performance.now(),r.postMessage(s)}catch(e){p.error(`[MjpegstreamerCamera] failed to start playback "${this.camera.name}"`,e),this.updateStatus("error")}}stopPlayback(){this.worker?.terminate(),this.worker=null,this.revokeImageObjectURL(),this.updateStatus("disconnected"),this.cameraImage.src=""}};m([u("streamingElement")],n.prototype,"cameraImage",2);n=m([g({})],n);var v=function(){var e=this,r=e._self._c;return e._self._setupProxy,r("img",{directives:[{name:"show",rawName:"v-show",value:e.status==="connected",expression:"status === 'connected'"}],ref:"streamingElement",style:e.cameraStyle,attrs:{crossorigin:e.crossorigin},on:{load:e.handleImageLoad,error:e.handleImageError}})},w=[],k=d(n,v,w,!1,null,null);const I=k.exports;export{I as default};
