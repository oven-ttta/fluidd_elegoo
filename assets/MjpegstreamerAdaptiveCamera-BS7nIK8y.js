import{m as c,f as h,R as u,C as l,j as p}from"./index-D8ybx4Tv.js";import{C as g}from"./camera-BQeuiYoI.js";var d=Object.defineProperty,f=Object.getOwnPropertyDescriptor,n=(m,e,a,r)=>{for(var t=r>1?void 0:r?f(e,a):e,s=m.length-1,i;s>=0;s--)(i=m[s])&&(t=(r?i(e,a,t):i(t))||t);return r&&t&&d(e,a,t),t};let o=class extends c(g){cameraImage;cameraImageSource="";cameraImageSourceUrl=null;requestStartTime=0;startTime=0;time=0;requestTime=0;timeSmoothing=.6;requestTimeSmoothing=.1;get autoRaiseFrameEvent(){return!1}handleImageLoad(){this.updateStatus("connected"),this.$emit("frame",this.streamingElement);const e=!document.hasFocus()&&this.camera.target_fps_idle||this.camera.target_fps||10,a=performance.now(),r=a-this.startTime;this.time=this.time*this.timeSmoothing+r*(1-this.timeSmoothing),this.startTime=a;const t=1e3/e,s=performance.now()-this.requestStartTime;this.requestTime=this.requestTime*this.requestTimeSmoothing+s*(1-this.requestTimeSmoothing);const i=Math.max(0,t-this.requestTime);this.$nextTick(()=>{setTimeout(this.handleRefresh,i)})}handleRefresh(){document.hidden?this.stopPlayback():(this.time!==0&&this.updateFramesPerSecond(Math.round(1e3/this.time)),this.$nextTick(()=>this.updateCameraImageSource()))}updateCameraImageSource(){const e=this.cameraImageSourceUrl;e&&(e.searchParams.set("cacheBust",Date.now().toString()),this.requestStartTime=performance.now(),this.cameraImageSource=e.toString())}startPlayback(){try{this.updateStatus("connecting"),this.cameraImageSourceUrl=this.buildAbsoluteUrl(this.camera.snapshot_url||""),this.time=0,this.startTime=performance.now(),this.updateCameraImageSource();const e=this.buildAbsoluteUrl(this.camera.stream_url||"");e.searchParams.set("cacheBust",Date.now().toString()),this.updateRawCameraUrl(e.toString())}catch(e){h.error(`[MjpegstreamerAdaptiveCamera] failed to start playback "${this.camera.name}"`,e)}}stopPlayback(){this.updateStatus("disconnected"),this.cameraImageSourceUrl=null,this.cameraImageSource="",this.cameraImage.src=""}};n([u("streamingElement")],o.prototype,"cameraImage",2);o=n([l({})],o);var S=function(){var e=this,a=e._self._c;return e._self._setupProxy,a("img",{directives:[{name:"show",rawName:"v-show",value:e.status==="connected",expression:"status === 'connected'"}],ref:"streamingElement",style:e.cameraStyle,attrs:{src:e.cameraImageSource,crossorigin:e.crossorigin},on:{load:e.handleImageLoad,error:function(r){return e.updateStatus("error")}}})},_=[],T=p(o,S,_,!1,null,null);const w=T.exports;export{w as default};
